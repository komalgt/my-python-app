name: Auto Label New Issues

on:
  issues:
    types: [opened]

jobs:
  label_issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Auto-label issue based on title keywords
        uses: actions/github-script@v7
        with:
          script: |
            // Code Generated by Sidekick is for learning and experimentation purposes only.
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const issue_number = context.payload.issue.number;
            const title = context.payload.issue.title.toLowerCase();

            const keywordLabelMap = {
              bug: "bug",
              feature: "enhancement",
              doc: "documentation",
              urgent: "priority: urgent"
            };

            let matchedLabels = [];
            for (const [keyword, label] of Object.entries(keywordLabelMap)) {
              if (title.includes(keyword)) {
                matchedLabels.push(label);
              }
            }

            if (matchedLabels.length > 0) {
              await github.rest.issues.addLabels({
                owner,
                repo,
                issue_number,
                labels: matchedLabels
              });
            }
